<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BEATBAY - Feel the Music</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div class="header-bar">
        <div class="header-options">
            <div class="header-options-icon"><i class="fa-solid fa-bars"></i></div>
            <div class="header-options-img"><img src="logo-round.png" alt=""></div>
            <div class="header-options-input"><input type="search" placeholder="Search songs,albumbs,artists"></div>
            <div class="loggedinusername" id="loggedinusername"></div>

        </div>

        <div class="header-slidebar">
            <div class="header-slidebar-options">
                <div class="aa"><i class="fa-regular fa-house"></i><p>Home</p></div>
                <div class="aa"><i class="fa-brands fa-wpexplorer"></i><p>Explore</p></div>
                <div class="aa"><i class="fa-solid fa-download"></i><p>Downloads</p></div>

            </div>

        </div>

    </div>

    <div class="mainforbackground">
        <h2 class="downloadedsongstitle">Your Downloaded Songs </h2>
        <div id="downloaded-songs" class="downloadedcontainer"></div>
    </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const loggedUser = localStorage.getItem("logedinuser");
  if (!loggedUser) {
    alert(" Please login first to view your downloads!");
    window.location.href = "login.html"; 
    return;
  }

  const storageKey = `downloadedSongs_${loggedUser}`;
  const downloadedSongs = JSON.parse(localStorage.getItem(storageKey)) || [];
  const container = document.getElementById("downloaded-songs");

  if (downloadedSongs.length === 0) {
    container.innerHTML = "<p>Your Downloads is Empty</p>";
    return;
  }

  container.innerHTML = downloadedSongs.map(song => `
    <div class="popup-content downloaded-songs-list">
      <img src="${song.image}" alt="${song.title}" width="70">
      <h4>${song.title}</h4>
      <i class="fa-solid fa-trash delete-icon"></i>
      <audio src="${song.audio}" controls></audio>
    </div>
  `).join("");











  container.addEventListener("click", (e) => {
  if (e.target.classList.contains("delete-icon")) {
    const loggedUser = localStorage.getItem("logedinuser");
    const storageKey = `downloadedSongs_${loggedUser}`;
    let downloadedSongs = JSON.parse(localStorage.getItem(storageKey)) || [];

    // Get the song title from this card
    const songCard = e.target.closest(".downloaded-songs-list");
    const songTitle = songCard.querySelector("h4").innerText;

    // Filter out the deleted song
    downloadedSongs = downloadedSongs.filter(song => song.title !== songTitle);
    localStorage.setItem(storageKey, JSON.stringify(downloadedSongs));

    // Remove from the DOM visually
    songCard.remove();

    alert(`"${songTitle}" has been removed from your downloads.`);
  }





});






});





window.addEventListener("DOMContentLoaded", () => {
    const username = localStorage.getItem("logedinuser");
    const usernameDiv = document.getElementById("loggedinusername");

    if (username && usernameDiv) {
        usernameDiv.textContent = `Welcome to BeatBay, ${username}!`;
    } else {
        usernameDiv.textContent = "Guest";
    }




    document.querySelectorAll(".aa").forEach((btn) => {
        btn.addEventListener("click", () => {
            const label = btn.querySelector("p")?.innerText.trim();
            const loggedUser = localStorage.getItem("logedinuser");

            if (label === "Downloads") {
                if (!loggedUser) {
                    alert("You have not logged in! Please login first to access your downloads.");
                    return;
                }

                window.location.href = "downloads.html";

            }

            if(label==="Home"){
                window.location.href="home.html";
            }

        });
    });




});






</script>



</body>
</html>